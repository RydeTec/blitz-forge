
* ПРОЕЦИРУЕМЫЕ ТЕНИ:

Тени в библиотеке представлены двумя подключаемыми файлами ShadowsSimple.bb и ShadowsMultiple.bb

ShadowsSimple.bb - это самая простая система теней, имеющая одну теневую карту (текстуру), которую
можно расположить на ресиверы - любые меши, на которые будет падать тень. Первая система более
компактная и более простая для понимания, чем вторая, но позволяет делать только простое затенение.
Примеры использования: все ShadowsSimple_*.bb файлы.

ShadowsMultiple.bb - это более продвинутая система, где можно создать любое количество теневых систем.
Каждая теневая система имеет свою теневую карту и набор кастеров - мешей, отбрасывающих тени.
Максимальное количестко кастеров на одну теневую систему определяется константой ShadowCastersMax=2048,
если этого мало, то можете задать большее число, исправив значение константы в исходнике ShadowsMultiple.bb 
Любой кастер может принадлежать одной из теневых систем или сразу нескольким, что дает возможность
делать более интересные эффекты и делать псевдо-самозатенение.
Примеры использования: все ShadowsMultiple_*.bb файлы.

Функциональный набор у обоих систем одинаковый, но для ShadowsMultiple.bb почти во всех функциях
используется дополнительный параметр - указатель на теневую систему, смотрите подробнее в описании
функций.


Достоинства:

	- На данный момент IMHO, единственные тени, которые можно использовать в реальных проектах,
	  созданных на Блиц3Д благодаря их скорости. Все остальные варианты теней пока не могут
	  дать приемлемого ФПС в реальных проектах.

	- Очень быстрая скорость работы, используется дополнительный рендеринг только для кастеров.
	  Наложение теневой карты происходит через DirectX7 с помошью 3Д проецирования, без
	  каких либо дополнительных расчетов и перебора вершин объектов.

	- Кастером и ресивером может быть абсолютно любой меш, независимо от его геометрии.
	  Например обычный меш, меш с анимацией, ландшафт и т.п.

	- Правильное отображение тени от кастеров, содержащих прозрачные или маскированные
	  текстуры (например трава, листья деревьев, заборы из железной сетки и т.п.)

	- Есть возможность увеличения производительности системы. Можно использовать в качестве
	  кастеров низкополигональные модели, причем визуально это будет выглядеть хорошо.


Недостатки:

	- Отсутствует самозатенение.

	- Теневая карта проецируется насквозь всего объекта, на котором она расположена (ресивера).
	  В итоге она попадает на бак-фейсы ресиверов, а также на все части ресивера, расположенные
	  на пути между источником света и кастерами.

	- При расположении кастера полность или частично внутри ресивера всегда будет видно тень
	  от внутренней части кастера. Смотрите пример ShadowsSimple_ReceiversUse.bb - он поможет
	  частично решить проблему.

	- Смотрите все возможные недостатки на картинках в папке .\images\

Рекомендации:

	- Используйте классический латмаппинг для всех статических объектов.
	- Используйте динамические тени ТОЛЬКО для динамических объектов (меняющих свое месторасположение в пространстве).
	- Система теней - не инструмент для решения всех проблем, используйте ее аккуратно.


Функции:	


CreateShadow (quality%=1, mode%=1)
	Функция создает теневую систему.
	Параметр quality% может иметь следующие значения:
		0 - размер теневой карты 512x512 точек
		1 - размер 1024x1024 точек
		2 - размер 2048x2048 точек
		Размер автоматически ограничивается под максимальный размер текстуры, который поддерживает видеокарты.

	Параметр mode% может иметь значения:
		0 - используется рендеринг непосредственно в теневую текстуру.
		1 - используется рендеринг в BackBuffer с последующим копированием в теневую текстуру
		    с помощью CopyRect. Достоинство - максимальная стабильность работы на старых видеокартах.
		    Недостаток - немного ниже скорость работы, размер теневой текстуры ограничивается размерами
		    текущего графического режима (к примеру если графический режим 1024x768, то макстимальный
		    размер теневой текстуры будет 512x512 точек, а этого порой мало).
		
	Возвращает:
	- для аддона ShadowsSimple.bb ничего не возвращает
	- для аддона ShadowsMultiple.bb возвращает объект с типом Shadow для последующего использования в системе


UpdateShadows% (camera%, tween#=1.0)
	Основная функция, которая обновляет теневые карты и всю систему в целом.
	Эту функцию следует использовать в основном цикле вашего приложения перед функцией RenderWorld (и после UpdateWorld).
	Параметры:

		camera% - передавайте в этот парамет главную камеру сцены (из которой видим зритель).
			Можно задать и любой другой объект, если это требуется, но нужно помнить, что теневая текстура
			будет распространятся относительно этого объекта.

		tween# - используется для твининга объектов, аналог tween# из функции RenderWorld.

	Возможно вызывать функцию через кадр или через несколько кадров, чтобы увеличить производительность, если кастеры
	и световой источник перемещаются незначительно. Иначе отставание теней от кастеров будет сильно заметно.


ShadowLight% (light_entity%=-1) - для аддона ShadowsSimple.bb
ShadowLight% (ShadowIn.Shadow, light_entity%=-1) - для аддона ShadowsMultiple.bb
	Функция задает источник света через параметр light_entity%, из которого будут проецироваться тени.
	Источником может быть любой объект. Используется только направление объекта в пространстве
	и соответственно системой поддерживаются только направленные источники света (directional).
	Если параметр light_entity% не задан или равен -1, то функция вернет текущий истоник света,
	который используется в системе.


ShadowOffset (x#=0, y#=0, z#=0)
ShadowOffset (ShadowIn.Shadow, x#=0, y#=0, z#=0)
	Функция задает смещение тени в пространстве, если тень ложится неровно на ресивер.
	Эта функция может потребоваться в некоторых случаях, все зависит от формы и сетки меша-ресивера.


ShadowFade% (fadeTexture%=-1)
ShadowFade% (ShadowIn.Shadow, fadeTexture%=-1)
	С помощью этой функции можно задать текстуру плавного проявления теней на границе теневого диапазона.
	Передавайте вашу текстуру через параметр fadeTexture%. Если параметр не задан или равен -1,
	то функция вернет текущую текстуру или ноль, если текстура не была задана ранее.
	По умолчанию такая текстура не задана и тени пропадают и появляются резко на границе.
	Смотрите примеры ShadowsSimple_FadeOut.bb и ShadowsMultiple_FadeOut.bb 


ShadowColor# (r#=255, g#=255, b#=255)
ShadowColor# (ShadowIn.Shadow, r#=255, g#=255, b#=255)
	Функция задает цветовой тон для тени.
	Рекомендую задавать "холодный" тон тени, если освещение на сцене в "теплых" тонах, это более
	реалистично смотрится, так как в природе действует тот же самый закон.
	По умолчанию цветовой тон тени нейтральный и не имеет оттенка.


ShadowPower# (power#=-1)
ShadowPower# (ShadowIn.Shadow, power#=-1)
	Функция задает непрозрачность (силу) тени с помощью параметра power#.
	Если параметр power# не задан или равен -1, то функция вернет текущее значение силы тени.
	По умолчанию прозрачность равна 50% (0.5)


ShadowRange# (range#=-1)
ShadowRange# (ShadowIn.Shadow, range#=-1)
	Функция задает диапазон действия тени в пространстве с помощью параметра range#.
	За границами этого диапазона тени от кастеров не будут отображаться.
	Следует учитывать - чем больше диапазон, тем большую площадь сцены покроет тень,
	но будет ниже качество тени (будет проявляться пикселизация) тени.
	Если параметр range# не задан или равен -1, то функция вернет текущий диапазон
	теневой системы. По умолчанию range# равен 50.


ShadowTexture% ()
ShadowTexture% (ShadowIn.Shadow)
	Функция возвращает теневую карту (текстуру), которую следует расположить на всех
	ресиверах. Текстура должна распологаться на самом верхнем неиспользуемом слое объекта.


ShowShadow% () - для аддона ShadowsSimple.bb
ShowShadow% (ShadowIn.Shadow) - для аддона ShadowsMultiple.bb
	Включает отображение и апдейт теневой системы (если она была скрыта ранее).



HideShadow% () - для аддона ShadowsSimple.bb
HideShadow% (ShadowIn.Shadow) - для аддона ShadowsMultiple.bb
	Скрывает отображение и апдейт теневой системы (если она была включена ранее).


DebugShadow% (x%=0, y%=0, width%=256, height%=256)
DebugShadow% (ShadowIn.Shadow, x%=0, y%=0, width%=256, height%=256) - для аддона ShadowsMultiple.bb
	Функция позволяет увидеть на экране теневую карту.
	Можно задать позицию теневой карты, параметры x и y (по умолчанию равны нулю).
	А также задать размер для отображения теневой карты, параметры width и height (по умолчанию равны 256 точек).


ShadowBlur% (alpha#=1.0, blurPass%=4, blurRadius#=0.1, quality%=0)
ShadowBlur% (ShadowIn.Shadow, alpha#=1.0, passes%=4, radius#=0.1, quality%=0)
	Функция включает или отключает эффект размытия для теневой карты.
	alpha# - уровень прозрачности размытия
		равно нулю - отключает размытие
		больше нуля - регулируем видимость оригинальной и размытой теневой карты
		равно единице - теневая карта полностью размыта 
	blurPass% - кол-во проходов размытия
	blurRadius$ - радиус размытия
	quality% - качество эффекта размытия
		0 и 1 - очень быстрый метод, возможны артефакты на некоторых видеокартах (0 - нормальное качество, 1 - высокое качество)
		2 и 3 - более медленный метод, гарантированно без артефактов, а также может работать быстрее на некоторых видеокартах (2 - нормальное качество, 3 - высокое качество)
	Пример использования: ShadowsSimple_PostBlur.bb


ShadowUpdate% (ShadowIn.Shadow, enable%=-1)
	Только для ShadowsMultiple.bb. Функция позволяет включать/отключать апдейт теневой карты для любой тени в ShadowsMultiple системе.
		enable% = -1 - возвращает флаг апдейта (он по умолчанию ключен и равен единице)
		enable% = 0 - отключает апдейт теневой карты
		enable% = 1 - включает апдейт
	Пример использования: ShadowsMultiple_Demo.bb


FreeShadows% ()
	Если теневая система больше не нужна, то можно удалить ее с помощью этой функции, ее следует использовать
	перед такими функциями как ClearWorld и DeInitExt.
	Внимание! Если ваше приложение удаляет теневую систему, но продолжает работать, то надо помнить,
	что теневые текстуры не будут удалены (и будут занимать видеопамять) до тех пор, пока вы не удалите их
	со всех ресиверов или не удалите сами ресиверы.




* ФУНКЦИИ ДЛЯ ОТБРАСЫВАНИЯ ТЕНЕЙ:

CreateShadowCaster% (caster_entity%)
CreateShadowCaster% (ShadowIn.Shadow, caster_entity%)
	Меш, заданный в параметре caster_entity%, будет подключен к теневой системе и будет отбрасывать тень
	(являться кастером и рендерится в теневую карту системы).


HideShadowCaster% (caster_entity%)
HideShadowCaster% (ShadowIn.Shadow, caster_entity%)
	С помощью этой функции можно отменить отбрасывание тени от объекта, скрыть его от рендеринга
	в теневую текстуру. Но сам объект останется в теневой системе. Это может потребоваться в некоторых
	ситуациях и удобнее, чем удаление и последующее создание кастера.


ShowShadowCaster% (caster_entity%)
ShowShadowCaster% (ShadowIn.Shadow, caster_entity%)
	Включить отбрасывание тени для объекта, ранее отмененное командой HideShadowCaster.


FreeShadowCaster% (caster_entity%)
FreeShadowCaster% (ShadowIn.Shadow, caster_entity%)
	Отключить объект от теневой системы.


FindShadowCaster% (caster_entity%)
FindShadowCaster% (ShadowIn.Shadow, caster_entity%)
	С помощью функции можно узнать, присутствует ли данный объект (receiver_entity%) в теневой системе.
	Если функция возвращает -1, то объект не подключен к теневой системе.




* ФУНКЦИИ ДЛЯ ПРИЕМНИКОВ ТЕНЕЙ:

AttachShadowReceiver% (receiver_entity%, showAuto%=0)   - for ShadowsSimple.bb
AttachShadowReceiver% (ShadowIn.Shadow, receiver_entity%, showAuto%=0)   - for ShadowsMultiple.bb
	Меш, заданный в параметре receiver_entity%, будет подключен к теневой системе.
	Если объект, отбрасывающий тень, расположен внутри приемника теней или пересекается с ним,
	тогда эта функция может быть использована для устранения ложный теней.
	showAuto% - используйте для LOD ресиверов (скрытых в 3Д мире). Автоматически показывает объект
		перед рендерингом теневой карты, и скрывает после рендеринга. 
	showAlways% - используйте для ентитей, не имеющих culling box (plane, sprite и т.п.)
		Такой ресивер будет всегда рендерится в теневую карту, даже если находится за её пределами.
		(Конечно если он не скрыт функцией HideShadowReceiver).
	Приемник теней, добавленный с помошью этой функции, будет рендерится внутри теневой системы,
	соответственно нагружать видеокарту. Следует иметь это ввиду и не добавлять без необходимости.
	Пример использования: ShadowsSimple_ReceiversUse.bb 


HideShadowReceiver% (receiver_entity%)   - for ShadowsSimple.bb
HideShadowReceiver% (ShadowIn.Shadow, receiver_entity%)   - for ShadowsMultiple.bb
	Оключает использование объекта (receiver_entity%) в теневой системе. Сам объект останется
	в теневой системе. Это может потребоваться в некоторых ситуациях и удобнее, чем удаление
	и последующее создание кастера.


ShowShadowReceiver% (receiver_entity%)   - for ShadowsSimple.bb
ShowShadowReceiver% (ShadowIn.Shadow, receiver_entity%)   - for ShadowsMultiple.bb
	Включает рендеринг/использование объекта-приемника теней (receiver_entity%) в теневой системе.
	

FreeShadowReceiver% (receiver_entity%)   - for ShadowsSimple.bb
FreeShadowReceiver% (ShadowIn.Shadow, receiver_entity%)   - for ShadowsMultiple.bb
	Удаляет объект-приемник (receiver_entity%) из теневой системы.


FindShadowReceiver% (receiver_entity%)   - for ShadowsSimple.bb
FindShadowReceiver% (ShadowIn.Shadow, receiver_entity%)   - for ShadowsMultiple.bb
	С помощью функции можно узнать, присутствует ли данный объект (receiver_entity%) в теневой системе.
	Если функция возвращает -1, то объект не подключен к теневой системе.

